<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <!-- import CSS -->
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
</head>

<body>
  <div id="app">
    <el-input type="textarea" :autosize="{ minRows: 4, maxRows: 7}" placeholder="请输入json" v-model="json"></el-input>
    <el-button @click="revertJson">转换</el-button>
    <el-input type="textarea" :autosize="{ minRows: 7, maxRows: 9}" placeholder="结果" v-model="result"></el-input>
  </div>
</body>
<!-- import Vue before Element -->
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<!-- import JavaScript -->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>

<script>
  function toJson(name, jsonStr) {
    var json = eval('(' + jsonStr + ')');
    var explain = '///\t' + jsonStr + '\n';
    var field = '';
    var constructor_none = '\t' + name + '({';
    var constructor_json = '\t' + name + '.fromJson(dynamic json) {\n\t\t';
    var first = true;
    for (var key in json) {
      if (first) {
        constructor_json += 'if (json != null && json is Map) {\n';
        constructor_none += 'this.' + key;
      } else {
        constructor_none += ', this.' + key;
      }

      first = false;

      if (json[key] instanceof Object) {
        var childName = key.charAt(0).toUpperCase() + key.substr(1, key.length - 1);
        field += '\t' + childName + ' ' + key + ';\n';
        var childObj = toJson(childName, JSON.stringify(json[key]));
        explain = childObj + '\n\n' + explain;
        constructor_json += '\t\t\t' + key + ' = ' + childName + '.fromJson(json[\'' + key + '\']);\n';
      } else {
        field += '\tString ' + key + ';\n';
        constructor_json += '\t\t\t' + key + ' = json[\'' + key + '\'];\n';
      }

      explain += '///\t' + key + ' = ' + json[key] + '\n';
    }
    return explain + 'class ' + name + ' {\n' + field + '\n' + constructor_none + '});\n\n' + constructor_json + '\t\t}\n\t}\n}';
  };
  new Vue({
    el: '#app',
    data: {
      json: '{"name":"null","profile":{"sex":true,"age":123,"address":"earth"}}',
      result: '',
    },
    methods: {
      revertJson: function () {
        this.result = toJson('Entity', this.json);
      }
    },
  })
</script>

</html>
